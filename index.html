<!doctype html>
 
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <title>momo-fukuwarai</title>
    <meta name="description" content="${description}" />
    
    <style>*, *:before, *:after {
  box-sizing: border-box; 
}
html {
  font-size: 62.5%;
}
body {
  color: #444;
  background-color: hsl(0, 0%, 96%);
}
h1 {
  font-size: 1.8rem;
}

</style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/gh/phinajs/phina.js@v0.2.3/build/phina.js"></script>
    <script>// グローバルに展開
phina.globalize();

/*
 * アセット
 */ 
var ASSETS = {
  // 画像
  image: {
    'comp'  : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/completed.png',
    'base'  : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/foundation.png',
    'mouth' : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_mouth.png',
    'nose'  : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_nose.png',
    'leye'  : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_lefteye.png',
    'reye'  : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_righteye.png',
    'lbrow' : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_leftbrow.png',
    'rbrow' : 'https://raw.githubusercontent.com/remind-galaxy/momo-fukuwarai/main/parts_rightbrow.png',
  },
};

/*
 * 定数
 */
// パラメータ
var SCREEN_WIDTH   = 900; // 画面の幅
var SCREEN_HEIGHT  = 900; // 画面の高さ
var PICTURE_WIDTH  = 800; // 背景画像の横幅
var PICTURE_HEIGHT = 800; // 背景画像の高さ
var NOSE_X         = 500; // 鼻のX座標
var NOSE_Y         = 552; // 鼻のY座標
var NOSE_WIDTH     = 80;  // 鼻の幅
var NOSE_HEIGHT    = 60;  // 鼻の高さ
var FSIZE_LARGE    = 30;  // 文字サイズ（大きい文字）
var FSIZE_SMALL    = 10;  // 文字サイズ（普通の文字）
var BG_COLOR       = '#fbfafa'; // 背景色

/*
 * 変数
 */
//var

/*
 * メインシーン
 */
phina.define("MainScene", {
  // 継承
  superClass: 'DisplayScene',
  // 初期化
  init : function(option) { //画面サイズ調整のためoptionを追加
    // 親クラス初期化
    this.superInit(option); //画面サイズ調整のためoptionを追加
    // 背景色
    this.backgroundColor = BG_COLOR;
    // 背景を生成, 表示
    var back = Sprite('comp').addChildTo(this)
      .setPosition(SCREEN_WIDTH - PICTURE_WIDTH / 2, SCREEN_HEIGHT - PICTURE_HEIGHT / 2);
    // 最初のラベルを表示
    var label = Label({
      text       : '鼻のあたりをクリック，またはタップで開始',
      fontSize   : FSIZE_LARGE,
      fontFamily : 'sans-serif',
    }).addChildTo(this)
      .setPosition(SCREEN_WIDTH / 2, (SCREEN_HEIGHT - PICTURE_HEIGHT) / 2);
    // 鼻のあたりクリック用オブジェクト
    var hana = RectangleShape({
      stroke      : BG_COLOR,
      strokeWidth : 0.5,
      fill        : 0,
      width       : NOSE_WIDTH,
      height      : NOSE_HEIGHT,
    }).addChildTo(this)
      .setPosition(NOSE_X, NOSE_Y)
      .setInteractive(true);
    // 鼻のあたりをクリックしたときの処理
    hana.onpointstart = () => {
      console.log('鼻のあたりをクリック'); // コンソールにデバッグ
      hana.width  = 0; // オブジェクトをクリック出来なくする
      hana.height = 0; // オブジェクトをクリック出来なくする
      hana.hide(); // オブジェクトを非表示にする
      label.hide(); // 最初のラベルを非表示にする
      this.fukuwarai_prepare(); // 福笑い準備メソッドを実行
    };

  },
  // 毎フレーム更新
  update : function(app) {
    /*
    // クリアチェック
    if (this.bugNum <= 0) {
      // 経過時間
      var time = Math.floor(app.frame / app.fps);
      var msg  = time + "秒でクリアしました!!";
      // ゲーム終了
      this.exit({
          message: msg,
      });
    }
    */
  },
  // 福笑い用の画面に切り替え
  fukuwarai_prepare : function() {
    console.log('福笑い準備'); // コンソールにデバッグ
    // 福笑い用の顔（のっぺらぼう）を配置
    var back = Sprite('base').addChildTo(this)
      .setPosition(SCREEN_WIDTH - PICTURE_WIDTH / 2, SCREEN_HEIGHT - PICTURE_HEIGHT / 2);
    
  },
  /*
  // クリックイベントを取得
  onpointstart: function() {
    console.log('point start!'); // コンソールにデバッグ
    // 背景を生成, 表示
    var back_base = Sprite('base').addChildTo(this);
    back_base.setPosition(SCREEN_WIDTH - PICTURE_WIDTH / 2,
                          SCREEN_HEIGHT - PICTURE_HEIGHT / 2);
  },
  */
});

/*
 * メイン処理
 */
phina.main(function() {
  // アプリケーションを生成
  var app = GameApp({
    assets     : ASSETS, // アセット読み込み
    startLabel : 'main', // MainScene から開始
    // スクリーンサイズを変更
    width  : SCREEN_WIDTH,
    height : SCREEN_HEIGHT,
  });
  //app.enableStats(); // fps表示用
  // 実行
  app.run();
});

</script>
  </body>
</html>

